<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:cc="http://java.sun.com/jsf/composite"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:composite="http://java.sun.com/jsf/composite">

<!-- INTERFACE -->
<composite:interface>
</composite:interface>

<!-- IMPLEMENTATION -->
<composite:implementation>
	<div class="card card-w-title">
		<h3>Cadastro de Soliciatação de serviço - Nova Solicitação</h3>
		




		<p:fieldset legend="Dados" style="margin-bottom:20px">
			
			<p:panelGrid columns="2" style="width:400px;" columnClasses="label, value" styleClass="no-border form-group ui-panelgrid-blank"
				layout="grid">
				<h:outputText value="ATI:"  />
				<h:outputText value="#{solicitacaoBean.solicitacao.numeroATI}"/>
				
				<h:outputText value="BL:"/>
				<p:inputText value="#{solicitacaoBean.solicitacao.codigoBL}"/>
				
				<h:outputText value="Container:"/>
				<p><c:forEach var="item" items="#{solicitacaoBean.solicitacao.solicitacaoServicos}">
					#{item.container.numeroContainer},
				</c:forEach> </p>
			</p:panelGrid>	
			<p:panelGrid columns="2" style="width:400px;" columnClasses="label, value" styleClass="no-border form-group ui-panelgrid-blank">
				<h:outputText value="Solicitação"/>
				<h:outputText value="#{solicitacaoBean.solicitacao.id}"/>
			</p:panelGrid>

		</p:fieldset>

		<p:fieldset legend="Adicionar Serviço"	style="margin-bottom:20px">

			<p:panelGrid columns="1" styleClass="form-group ui-panelgrid-blank"
			layout="grid">
			<p:outputLabel value="Código do Container:" for="cc" />
			<p:autoComplete id="cc" dropdown="true" size="100" converter="containerConverter"
				value="#{solicitacaoBean.container}" var="item"
				itemLabel="#{item}" itemValue="#{item}" 
				update="#{p:component('panelContainerSelecionado')}"
				completeMethod="#{solicitacaoBean.pesquisaContainers}">
				<p:ajax event="itemSelect"
					listener="#{solicitacaoBean.adicionarContainer}"
					update="#{p:component('panelContainerSelecionado')}" />
			</p:autoComplete>
			</p:panelGrid>
			<p:panelGrid columns="1" layout="grid" id="panelContainerSelecionado" styleClass="form-group ui-panelgrid-blank">
			<p:dataTable value="#{solicitacaoBean.containersSelecionados}" var="item" reflow="true">
			<p:column headerText="Container">
				<h:outputText value="#{item.numeroContanier}"/>
			</p:column>
			<p:column>
				<p:commandLink id="btnExcluirContainer" value="Remover" update="@form" action="#{solicitacaoBean.removerContainer}">
					<f:setPropertyActionListener value="#{item}"
							target="#{solicitacaoBean.container}" />
					<p:confirm header="Confirmar Exclusão" message="Tem certeza que deseja excluir o registro?" 
						icon="ui-icon-alert" />
				</p:commandLink>
			 </p:column>
			
			</p:dataTable>
			
		
			</p:panelGrid>
			<p:panelGrid columns="1" layout="grid" styleClass="form-group ui-panelgrid-blank">
			<p:outputLabel for="acSolicitacaoServico" value="Serviço"/>
			<p:autoComplete id="acSolicitacaoServico" dropdown="true" size="100"
					value="#{solicitacaoBean.servico}" var="item"
					itemLabel="#{item}" itemValue="#{item}"
					update="#{p:component('descOutro')}"
					completeMethod="#{solicitacaoBean.pesquisaServico}">
					<p:ajax event="itemSelect"
						listener="#{solicitacaoBean.selecionarServico}"
						update="#{p:component('descOutro')}" />
				</p:autoComplete>
			<p:outputLabel for="descOutro" rendered="#{solicitacaoBean.outroServico}" value="Descrição - (*Outros)"/>
			<p:inputText id="descOutro" rendered="#{solicitacaoBean.outroServico}" required="true" requiredMessage="O preenchimento do campo é obrigatório." value="#{solicitacaoBean.descricaoOutros}"></p:inputText>
			</p:panelGrid>
			<p:panelGrid columns="1" layout="grid" styleClass="form-group ui-panelgrid-blank">
			<p:outputLabel for="dtSolicitacao" value="Data Solicitacao"/>
			</p:panelGrid>
			<p:panelGrid columns="2" styleClass="form-group ui-panelgrid-blank">
			<p:calendar id="dtSolicitacao" value="#{solicitacaoBean.dataSolicitacao}" disabled="true" pattern="dd/MM/yyyy"/>
			<p:commandButton icon="fa fa-calendar-plus" update="#{p:component('dtSolicitacao')}"
				onclick="PF('dlgServJanelaAtend').show();" actionListener="#{solicitacaoBean.carregarEventosServicoJanela}">
			</p:commandButton>
			</p:panelGrid>
			
				<p:toolbar>
				<f:facet name="left">
					<p:commandButton value="Adicionar" ajax="true" update="@form"
						icon="#{bundle.iconSalvar}" id="btSalvar"
						action="#{solicitacaoBean.adicionarSolicitacaoServico}" />


					<p:spacer width="20" />
					<p:commandButton value="Limpar" update="@form"
						icon="fa fa-undo" styleClass="orange-btn" id="btVoltar"
						action="#{solicitacaoBean.limparSolicitacaoServico}" />
				</f:facet>
			</p:toolbar>
			</p:fieldset>
			<p:dialog id="idDlgServJanelaAtend" widgetVar="dlgServJanelaAtend" modal="true">
			<p:schedule value="#{solicitacaoBean.lazyEventServicoJanela}"></p:schedule>
			
			</p:dialog>

			
			<p:fieldset legend="Serviços Selecionados">
			<p:dataTable id="tblServicosSelecionados" emptyMessage="Nenhum registro encontrado." value="#{solicitacaoBean.solicitacao.solicitacaoServicos}" var="item" 
				 style="margin-bottom:20px">
				<p:column headerText="Container">
					<h:outputText value="#{item.container.numeroContanier}"/>
				</p:column>				 
				<p:column headerText="Serviço">
					<h:outputText rendered="#{item.servico.unMedidaJanela != 'O'.charAt(0) }" value="#{item.servico.id} - #{item.servico.descricao}"/>
					<h:outputText rendered="#{item.servico.unMedidaJanela eq 'O'.charAt(0) }" value="#{item.servico.id} - #{item.servico.descricao} (#{item.outrosServicos})"/>
				</p:column>
				<p:column headerText="Data da Solicitacao" >
				<h:outputText value="#{item.dataSolicitacao}">
					<f:convertDateTime pattern="dd/MM/yyyy" />
				</h:outputText>
			</p:column>
				<p:column headerText="OS">
					<h:outputText value="#{item.OS}"/>
				</p:column>	
				<p:column headerText="Status">
					<h:outputText value="#{item.statusServicos}"/>
				</p:column>	
				
				<p:column>
				<p:commandLink id="btnExcluirSolicitacaoServico" value="Remover" update="@form" action="#{solicitacaoBean.removerSolicitacaoServico}">
					<f:setPropertyActionListener value="#{item}"
							target="#{solicitacaoBean.solicitacaoServico}" />
					<p:confirm header="Confirmar Exclusão" message="Tem certeza que deseja excluir o registro?" 
						icon="ui-icon-alert" />
				</p:commandLink>
			 </p:column>
			
			</p:dataTable>
							 
			</p:fieldset>
			<p:fieldset legend="Anexos">
			<h:form id="frmAnexosSolicitacao" enctype="multipart/form-data">
					<h:panelGrid id="pnlAnexosSolicitacao" columns="1">

						<p:fileUpload label="Escolher arquivo (formato pdf até 3MB)" mode="advanced" dragDropSupport="false" sizeLimit="3000000"
							invalidSizeMessage="Tamanho máximo permitido: 3MB" allowTypes="/(\.|\/)(pdf)$/" invalidFileMessage="Extensão de arquivo permitida: PDF."
							fileUploadListener="#{solicitacaoBean.uploadAnexo}" auto="true" update="#{p:component('frmAnexosSolicitacao')}" />
						

						<p:dataTable id="tblAnexosImportacao" emptyMessage="Nenhum registro encontrado." value="#{solicitacaoBean.solicitacao.anexos}" var="anexo" 
							 style="margin-bottom:20px">

							<p:column headerText="Arquivo" width="270">
								<p:commandLink  value="#{anexo.caminhoAnexo}" actionListener="#{solicitacaoBean.download}" ajax="false" process="@this">
									<f:attribute name="anexoSelecionado" value="#{anexo}" />
									<p:fileDownload value="#{solicitacaoBean.pdf}" />
								</p:commandLink>
							</p:column>
							<p:column headerText="Descrição" width="270">
								<h:outputText value="#{anexo.caminhoAnexo}"/>
								
							</p:column>

							<p:column id="columRemoverAnexo">
								<p:commandLink id="btnRemoverAnexo" action="#{solicitacaoBean.removerAnexo}" icon="fa fa-trash-o" style="color: red">
									<f:setPropertyActionListener value="#{anexo}"
										target="#{solicitacaoBean.anexo}" />
									<p:tooltip for="btnRemoverAnexo" value="#{bundle.excluir}" showEffect="clip" hideEffect="explode" />
									<p:confirm header="Excluir" message="Deseja excluir este item ?" icon="ui-icon-alert" />
								</p:commandLink>
							</p:column>

						

						</p:dataTable>

					</h:panelGrid>
				</h:form>
			
			</p:fieldset>
			<p:fieldset legend="Mensagens">
			<h:form id="frmMensagemSolicitacao">
					<h:panelGrid id="pnlMensagemSolicitacao" lang="grid" columns="1">

						<p:inputText value="#{solicitacaoBean.mensagem.titulo}" placeholder="Informe o título da mensagem." size="100"/>
						<p:inputTextarea cols="100" rows="5" value="#{solicitacaoBean.mensagem.conteudo}" placeholder="Informe neste campo algum detalhe que será importante ao serviço solicitado."></p:inputTextarea>
						<p:dataTable id="tblmensagens" emptyMessage="Nenhum registro encontrado." value="#{solicitacaoBean.solicitacao.mensagems}" var="item" 
							 style="margin-bottom:20px">

							<p:column headerText="Data">
							<h:outputText value="#{item.data}">
									<f:convertDateTime pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>
							<p:column headerText="Remetente">
								<h:outputText value="#{item.usuario.name}"/>
							</p:column>
							<p:column>
						<p:commandLink id="btnVerMEnsagem" value="#{item.titulo}" actionListener="#{solicitacaoBean.visualizarMensagem}" 
							update="#{p:component('iddlgVerMensagem')}" onclick="PF('dlgVerMensagem').show();">
								<f:setPropertyActionListener value="#{item}" target="#{solicitacaoBean.mensagem}" />
						</p:commandLink>
					 </p:column>
							

						
							
						</p:dataTable>
							<p:dialog id="iddlgVerMensagem" widgetVar="dlgVerMensagem" modal="true" closable="true" closeOnEscape="true">
								<p:fieldset legend="Mensagem">
								<p:panelGrid columns="1">
								<br/>
								<h3>Autor: <h:outputText value="#{solicitacaoBean.mensagem.usuario.name}"/></h3>
								<br/>
								<br/>
								<h3>Título: <h:outputText value="#{solicitacaoBean.mensagem.titulo}"/></h3>
								<br/>
								<br/>
								<h4>Mensagem: <h:outputText value="#{solicitacaoBean.mensagem.conteudo}"/></h4>
								
								
								
								</p:panelGrid>
								
								</p:fieldset>
			
							</p:dialog>

					</h:panelGrid>
				</h:form>
			
			</p:fieldset>
			


		
	

	</div>

</composite:implementation>

</html>